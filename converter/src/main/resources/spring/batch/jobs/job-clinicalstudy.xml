<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:batch="http://www.springframework.org/schema/batch" 
	xmlns:task="http://www.springframework.org/schema/task"
	xmlns:util="http://www.springframework.org/schema/util" 
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.springframework.org/schema/batch
	http://www.springframework.org/schema/batch/spring-batch-2.2.xsd
	http://www.springframework.org/schema/beans 
	http://www.springframework.org/schema/beans/spring-beans-3.2.xsd
	http://www.springframework.org/schema/util 
	http://www.springframework.org/schema/util/spring-util-3.2.xsd">

    <batch:job id="clinicalSearchJob">
        <batch:step id="step1">
            <batch:tasklet>
                <batch:chunk reader="xmlItemReader" 
                    writer="cvsFileItemWriter" processor="FilterClinicalStudyProcessor"
                    commit-interval="1">
                </batch:chunk>
            </batch:tasklet>
        </batch:step>
    </batch:job>
    <!-- Filtering process -->
    <bean id="filterClinicalStudyProcessor" class="com.fratt.processor.FilterClinicalStudyProcessor" />

    <bean id="xmlItemReader" 
        class="org.springframework.batch.item.xml.StaxEventItemReader">
        <property name="fragmentRootElementName" value="record" />
        <property name="resource" value="classpath:xml/NCT00000102.xml" />
    </bean>


    <bean id="cvsFileItemWriter" class="org.springframework.batch.item.file.FlatFileItemWriter">
    	<!-- write to this csv file -->
        <property name="resource" value="classpath:csv/clinicalStudy.csv" />
        <property name="shouldDeleteIfExists" ref="true" />

        <property name="lineAggregator">
            <bean
            class="org.springframework.batch.item.file.transform.LineAggregator">
                <property name="delimitedLineAggregator">
                    <bean
                    class="org.springframework.batch.item.file.transform.DelimitedLineAggregator">
                        <property name="delimiter" value="," />
                        <property name="fieldExtractor">
                            <bean
                                class="org.springframework.batch.item.file.transform.BeanWrapperFieldExtractor">
                                <property name="names" value="download_date, link_text, url, org_study_id, nct_id, nct_alias, brief_title, official_title, agency, agency_class, source, has_dmc, textblock, overall_status, start_date, completion_date, type, primary_completion_date, type2, phase, study_type, has_expanded_access, allocation, intervention_model, primary_purpose, masking, measure, time_frame, description, measure3, time_frame4, description5, number_of_arms, enrollment, type6, condition, arm_group_label, arm_group_type	intervention_type, intervention_name, description7, arm_group_label8, textblock9, gender, minimum_age, maximum_age, healthy_volunteers, last_name, role	affiliation, name, city, state, country, country10, url11, description12, verification_date, study_first_submitted, study_first_submitted_qc, study_first_posted, type13, results_first_submitted, results_first_submitted_qc, results_first_posted, type14, last_update_submitted, last_update_submitted_qc, last_update_posted, type15, responsible_party_type, mesh_term, recruitment_details, pre_assignment_details, group_id, title, description16, title17, title18, group_id19, count, title20, group_id21, count22, group_id23, title24, units, scope, group_id25, value, title26, units27, param, dispersion, group_id28, value29, lower_limit, upper_limit, title30, type31, title32, description33, time_frame34, population, group_id35, title36, title37, description38, population39, units40, param41, units42, scope43, group_id44, value45, group_id46, value47, time_frame48, desc, group_id49, title50, default_vocab, default_assessment, title51, sub_title, group_id52, subjects_affected, subjects_at_risk, frequency_threshold, default_vocab53, default_assessment54, title55, sub_title56, group_id57, subjects_affected58, subjects_at_risk59, pi_employee, restrictive_agreement, name_or_title, organization, phone, email" />
                            </bean>
                        </property>
                    </bean>
                </property>
            </bean>
        </property>
    </bean>

</beans>

